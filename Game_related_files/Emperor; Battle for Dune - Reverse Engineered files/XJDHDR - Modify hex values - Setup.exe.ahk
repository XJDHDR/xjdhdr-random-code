#NoEnv
ListLines, Off

If A_Args.Length() = 0
{
	FileDelete, %A_ScriptDir%\Modify Setup hex values.log
	If FileExist(A_ScriptDir . "\SETUP.exe")
	{
		MsgBox, 3, SETUP.exe located in patcher's folder, SETUP.exe was found in the same place as this patcher. Is this the SETUP.exe you would like to patch (No will allow you to select the location of the one you want to patch)?,
		IfMsgBox, Cancel
			ExitApp
		IfMsgBox, Yes
		{
			sSetupExe := A_ScriptDir . "\SETUP.exe"
			If PerformHexEditing(sSetupExe) = False
				ExitApp
		}
		IfMsgBox, No
			SelectSetupLocation()
	}
	Else
	{
		SelectSetupLocation()
	}
}
Else
{
	FileDelete, %A_ScriptDir%\Modify Setup hex values.log
	For n, arParameter in A_Args
	{
		Loop Files, %arParameter%, FD
		{
			sParameter := A_LoopFileFullPath
		}
		If InStr(sParameter, "\SETUP.exe")
		{
			If PerformHexEditing(sParameter) = False
				Continue
			FileAppend, `n`n, %A_ScriptDir%\Modify Setup hex values.log,
		}
		Else
			FileAppend, SETUP.exe not found in parameter: %sParameter%`n`n, %A_ScriptDir%\Modify Setup hex values.log,
	}
}

MsgBox, Patching has been completed.
ExitApp


SelectSetupLocation()
{
	bSetupExeFound := 0
	While bSetupExeFound = 0
	{
		FileSelectFolder, sSetupLocation, ::{20d04fe0-3aea-1069-a2d8-08002b30309d}, 2, Please select where SETUP.exe is located.
		If %ErrorLevel% = 1
			ExitApp
		sSetupExe := sSetupLocation . "\SETUP.exe"
		bTestSetupLocationResult := TestSetuplocation(sSetupExe)
		If bTestSetupLocationResult = False
			Continue
		Else If bTestSetupLocationResult = True
			bSetupExeFound := 1
	}
	If PerformHexEditing(sSetupExe) = False
		ExitApp
}


TestSetuplocation(sPassedEXEPath)
{
	If Not FileExist(sPassedEXEPath)
	{
		MsgBox, 21, SETUP.exe not found, SETUP.exe was not found in the specified location.`nPlease select the correct location that SETUP.exe is located.,
		IfMsgBox, Retry
			Return, False
		Else IfMsgBox, Cancel
			ExitApp
	}
	Return, True
}


PerformHexEditing(sPassedExe)
{
	objFile := FileOpen(sPassedExe, "rw -rwd")
	If Not IsObject(objFile)
	{
		MsgBox, %sPassedExe% could not be opened and/or edited. Please ensure that this program has write permission to the location where SETUP.exe is located, by either moving SETUP.exe to a location where you have write permission or running this program with admin privileges.
		objFile.Close()
        Return, False
	}
	; Change registry accesses from the HKLM hive to HKCU
	; 0x80000002h -> 0x80000001h
	HexEditThenAddToLog(objFile, "02", "01", 86375)		; 0x00015167
	HexEditThenAddToLog(objFile, "02", "01", 86582)		; 0x00015236
	HexEditThenAddToLog(objFile, "02", "01", 86625)		; 0x00015261
	HexEditThenAddToLog(objFile, "02", "01", 145938)	; 0x00023A12
	HexEditThenAddToLog(objFile, "02", "01", 149645)	; 0x0002488D
	HexEditThenAddToLog(objFile, "02", "01", 164657)	; 0x00028331
	HexEditThenAddToLog(objFile, "02", "01", 166520)	; 0x00028A78
	HexEditThenAddToLog(objFile, "02", "01", 166558)	; 0x00028A9E
	HexEditThenAddToLog(objFile, "02", "01", 166666)	; 0x00028B0A
	HexEditThenAddToLog(objFile, "02", "01", 166704)	; 0x00028B30
	HexEditThenAddToLog(objFile, "02", "01", 166812)	; 0x00028B9C
	HexEditThenAddToLog(objFile, "02", "01", 166850)	; 0x00028BC2
	HexEditThenAddToLog(objFile, "02", "01", 268493)	; 0x000418CD
	HexEditThenAddToLog(objFile, "02", "01", 280473)	; 0x00044799
	HexEditThenAddToLog(objFile, "02", "01", 329978)	; 0x000508FA
	HexEditThenAddToLog(objFile, "02", "01", 330125)	; 0x0005098D
	HexEditThenAddToLog(objFile, "02", "01", 330479)	; 0x00050AEF
	HexEditThenAddToLog(objFile, "02", "01", 330554)	; 0x00050B3A
	HexEditThenAddToLog(objFile, "02", "01", 362820)	; 0x00058944
	HexEditThenAddToLog(objFile, "02", "01", 362958)	; 0x000589CE
	HexEditThenAddToLog(objFile, "02", "01", 371912)	; 0x0005ACC8
	HexEditThenAddToLog(objFile, "02", "01", 373719)	; 0x0005B3D7
	HexEditThenAddToLog(objFile, "02", "01", 373757)	; 0x0005B3FD
	HexEditThenAddToLog(objFile, "02", "01", 374926)	; 0x0005B88E
	HexEditThenAddToLog(objFile, "02", "01", 375226)	; 0x0005B9BA
	HexEditThenAddToLog(objFile, "02", "01", 375536)	; 0x0005BAF0
	HexEditThenAddToLog(objFile, "02", "01", 375739)	; 0x0005BBBB
	HexEditThenAddToLog(objFile, "02", "01", 376310)	; 0x0005BDF6
	HexEditThenAddToLog(objFile, "02", "01", 378146)	; 0x0005C522
	HexEditThenAddToLog(objFile, "02", "01", 378359)	; 0x0005C5F7
	HexEditThenAddToLog(objFile, "02", "01", 380226)	; 0x0005CD42


	; Do not edit the installed Resource.cfg
	HexEditThenAddToLog(objFile, "5245534F555243452E434647","000000000000000000000000", 551716)	; 0x00086B24 - F
	
	
	; Remove requirement for SETUP.exe to be on a CD labelled "EMPEROR1"
	; 0x74 -> 0xEB (jz -> jmp)
	HexEditThenAddToLog(objFile, "74", "EB", 401115)	; 0x00061EDB
	
	
	; Add special maifest - No admin required, no DPI scaling, Win7 compatible
	HexEditThenAddToLog(objFile, "E0", "60", 305)		; 0x00000131
	HexEditThenAddToLog(objFile, "50", "60", 353)		; 0x00000161
	HexEditThenAddToLog(objFile, "F00E", "C413", 412)	; 0x0000019C - D
	HexEditThenAddToLog(objFile, "F00E", "C413", 648)	; 0x00000288 - 9
	HexEditThenAddToLog(objFile, "10", "20", 657)		; 0x00000291
	HexEditThenAddToLog(objFile, "00", "04", 569352)	; 0x0008B008
	HexEditThenAddToLog(objFile, "03", "04", 569358)	; 0x0008B00E
	HexEditThenAddToLog(objFile, "28", "30", 569364)	; 0x0008B014
	HexEditThenAddToLog(objFile, "50", "58", 569372)	; 0x0008B01C
	HexEditThenAddToLog(objFile, "68", "70", 569380)	; 0x0008B024
	HexEditThenAddToLog(objFile, "00", "18", 569384)	; 0x0008B028
	HexEditThenAddToLog(objFile, "00", "88", 569388)	; 0x0008B02C
	HexEditThenAddToLog(objFile, "00", "80", 569391)	; 0x0008B02F
	sNewHex := "0000040000000000030001000000A000008002000000B800008003000000D000008000000000000000000400000000000100E02E0000E800008000000000000000000400000000000100260300000001008000000000000000000400000000000100010000001801008000000000000000000400000000000100090400003001000000000000000000000400000000000100090400004001000000000000000000000400000000000100090400005001000000000000000000000400000000000100090400006001000000000000000000000400000000000100090400007001000000000000000000000400000000000100000000008001000090410900E8020000E40400000000000078440900A8080000E404000000000000204D090028010000E404000000000000484E0900B2000000E404000000000000FC4E090030000000E4040000000000002C4F090097040000E4040000000000002800000020000000400000000100040000000000800200000000000000000000000000000000000000000000000080000080000000808000800000008000800080800000C0C0C000808080000000FF0000FF000000FFFF00FF000000FF00FF00FFFF0000FFFFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2800000020000000400000000100080000000000800400000000000000000000000000000000000000000000000080000080000000808000800000008000800080800000C0C0C000C0DCC000F0CAA60004040400080808000C0C0C0011111100161616001C1C1C002222220029292900555555004D4D4D004242420039393900807CFF005050FF009300D600FFECCC00C6D6EF00D6E7E70090A9AD000000330000006600000099000000CC00003300000033330000336600003399000033CC000033FF00006600000066330000666600006699000066CC000066FF00009900000099330000996600009999000099CC000099FF0000CC000000CC330000CC660000CC990000CCCC0000CCFF0000FF660000FF990000FFCC00330000003300330033006600330099003300CC003300FF00333300003333330033336600333399003333CC003333FF00336600003366330033666600336699003366CC003366FF00339900003399330033996600339999003399CC003399FF0033CC000033CC330033CC660033CC990033CCCC0033CCFF0033FF330033FF660033FF990033FFCC0033FFFF00660000006600330066006600660099006600CC006600FF00663300006633330066336600663399006633CC006633FF00666600006666330066666600666699006666CC00669900006699330066996600669999006699CC006699FF0066CC000066CC330066CC990066CCCC0066CCFF0066FF000066FF330066FF990066FFCC00CC00FF00FF00CC009999000099339900990099009900CC009900000099333300990066009933CC009900FF00996600009966330099336600996699009966CC009933FF009999330099996600999999009999CC009999FF0099CC000099CC330066CC660099CC990099CCCC0099CCFF0099FF000099FF330099CC660099FF990099FFCC0099FFFF00CC00000099003300CC006600CC009900CC00CC0099330000CC333300CC336600CC339900CC33CC00CC33FF00CC660000CC66330099666600CC669900CC66CC009966FF00CC990000CC993300CC996600CC999900CC99CC00CC99FF00CCCC0000CCCC3300CCCC6600CCCC9900CCCCCC00CCCCFF00CCFF0000CCFF330099FF6600CCFF9900CCFFCC00CCFFFF00CC003300FF006600FF009900CC330000FF333300FF336600FF339900FF33CC00FF33FF00FF660000FF663300CC666600FF669900FF66CC00CC66FF00FF990000FF993300FF996600FF999900FF99CC00FF99FF00FFCC0000FFCC3300FFCC6600FFCC9900FFCCCC00FFCCFF00FFFF3300CCFF6600FFFF9900FFFFCC006666FF0066FF660066FFFF00FF666600FF66FF00FFFF66002100A5005F5F5F00777777008686860096969600CBCBCB00B2B2B200D7D7D700DDDDDD00E3E3E300EAEAEA00F1F1F100F8F8F800F0FBFF00A4A0A000808080000000FF0000FF000000FFFF00FF000000FF00FF00FFFF0000FFFFFF00224C1D0A0A1D1D0A0A0A0A0A0A0A0C0C0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A0A224C1D0A0A1D1D0A0A0A0A0C0C0C0C0C0A0A0A0A0A0A0A0C0C0C0A0A0A0A0A0A0F4B1D0A0A1D220C0C0C0C0E0E0C0C0C0C0A0A0C0C0C0C0E0E0F0C0A0A0A0A0A0C4B220C0C22230C0C0E0E0F0F0E0E0E0E0E0E0E0C0C0C0E0F0F0E0C0A0A0A0A0C4B4544454B440E0E0F100F0F0F110F0E0C0A0A0A0A0A0C0E0E0E0E0C0A0A0A0C4B4B4B454B4B0F0F0F0F0F0F0F0F0E0E0F0F0F0E0C0A0A0A0C0E0E0C0C0A0A0C444B4545444B11110F0F0F100F0F431544441543110F0C0A0A0C0E0C0C0A0A0A23524B4B0F4444100F0F0F0F1144444A4A4A4A4444430F0E0A0A0E0E0C0A0A0C0F4B224B1511440F0F111010444A4B4B6E6E6E4A4A4415100C0A0C0E0C0C0A0C0E44444B440F444311430F446E6E6E6E73736E6E6E4A44150F0C0C0E0C0C0A110E224544440F43441143116E6E737474747474746E6E4A44430E0A0E0C0A0A0E0E0E4B444B1111441415146E737474747474747474736EEA140F0C0A0E0C0A0E0F0F4B52441515146E144A73747474747474749374746E4A44110C0A0C0C0A0E1010444C431514146EEAEA7474747474997474747474736E4A430E0A0C0C0A0C0E0F11444A4314156E754A7474747474997474747474736E4A430E0C0C0A0A0E0E100F114B12136E6E6E4B74747474999974747474736E6E4A430C0C0C0A0A0E0F0F0E0F4A74746E1414447493999399997474746E6E6E6D12110A0C0C0A0A0F0F0E0E0F43746F131414154B7499937474746F6E6E6E6E6D140E0E0C0C0A0A11110F0F0F10446F12141414145274744C4C6E6E6E6E6E6D12110C0E0E0C0A0A0F1111110F0F0F446FEA13136E144B6E4B4B4B6E6E6E6E12110C0E0E0E0E0A0A0F111543100F10436E746E6E144343444B4B4B4A4A4A440F0C0C0E0E0E0C0A0A0F111514434343436E6E736E151543154444230F0F0F0E0C0C0C0E0E0C0C0A0A1043151443431143134B744C4443151515144B4B440E0C0C0C0C0E0E0E0C0C0A0F11150A0A0A0A0A0F12EAEAEA12EAEA12EAEA12EA6DEA0F0A0A0A0A0A0C0C0A0F11430E0F100F0E0F736E737373737373731C73731C1C100E0F0E0E0E0E0C0A0F10114B514B4B43100F154315101015151515431443110F11514A4A4B2322220E0F119974104A6E6E1074EA79141179EA4A7373746D1414EA9973991C0F1D0E10110F1C99121273997399EA99746E996E1474991C736E6E1C9999996D0A0A0A0F110F7474EA12144A124A144AEAEA6D4A14124A12146E6E12797374730A0A0A0E0F0F114343430E0C0C0C0C0E0E0E0E0E0E0E0E0C0C0C0C0F1415430F1D1D1D0E0E0F0F0E0C0C0E0E0F0E0E0E0E0E0E0E0E0E0C0C0C0C0E102344454B4B4C4C0C0C0E0C0C0A0C0C0E0E0E0E0E0E0C0C0C0E0C0C0C0A0C0C0C0C0C0E1D0F222300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002800000010000000200000000100040000000000C00000000000000000000000000000000000000000000000000080000080000000808000800000008000800080800000C0C0C000808080000000FF0000FF000000FFFF00FF000000FF00FF00FFFF0000FFFFFF003000000000000000300000000000000031300000000000003310000011000000010300388831000003100088888800000330888877883000008488877788800000885377788880000008448888880000000088413330000005008804130000000000888888800000070808578885770008838388581878000000000000001333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004400C8800000000004000A0014003B01EA0000000000000008004D0053002000530061006E007300200053006500720069006600000000000100035000000000CC00D80032000E002003FFFF8000260059006500730000000000000000000150000000000201D80032000E002103FFFF800026004E006F000000000010000050000000000400D20034010100FFFFFFFF82000000000000000408A350000000000A000A002701C1002503FFFF81000000000050410000010003002020100001000400E802000001002020000001000800A8080000020010101000010004002801000003003C3F786D6C2076657273696F6E3D22312E302220656E636F64696E673D225554462D3822207374616E64616C6F6E653D22796573223F3E0D0A3C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A093C617373656D626C794964656E746974790D0A0909747970653D2277696E3332220D0A09096E616D653D22584A444844522E506572736F6E616C4D6F64732E456D7065726F72426174746C65466F7244756E652E5365747570457865220D0A090970726F636573736F724172636869746563747572653D22783836220D0A090976657273696F6E3D22312E302E302E30220D0A092F3E0D0A0D0A093C636F6D7061746962696C69747920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A636F6D7061746962696C6974792E7631223E200D0A09093C6170706C69636174696F6E3E200D0A0909093C212D2D546869732049642076616C756520696E6469636174657320746865206170706C69636174696F6E20737570706F7274732057696E646F77732056697374612066756E6374696F6E616C697479202D2D3E0D0A0909093C737570706F727465644F532049643D227B65323031313435372D313534362D343363352D613566652D3030386465656533643366307D222F3E0D0A0909093C212D2D546869732049642076616C756520696E6469636174657320746865206170706C69636174696F6E20737570706F7274732057696E646F777320372066756E6374696F6E616C6974792D2D3E0D0A0909093C737570706F727465644F532049643D227B33353133386239612D356439362D346662642D386532642D6132343430323235663933617D222F3E0D0A09093C2F6170706C69636174696F6E3E200D0A093C2F636F6D7061746962696C6974793E0D0A0D0A093C7472757374496E666F20786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E7633223E0D0A09093C73656375726974793E0D0A0909093C72657175657374656450726976696C656765733E0D0A090909093C726571756573746564457865637574696F6E4C6576656C0D0A09090909096C6576656C3D226173496E766F6B6572220D0A090909090975694163636573733D2266616C7365220D0A090909092F3E0D0A0909093C2F72657175657374656450726976696C656765733E0D0A09093C2F73656375726974793E0D0A093C2F7472757374496E666F3E0D0A093C6170706C69636174696F6E20786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E7633223E0D0A09093C77696E646F777353657474696E67730D0A090909786D6C6E733D22687474703A2F2F736368656D61732E6D6963726F736F66742E636F6D2F534D492F323030352F57696E646F777353657474696E6773223E0D0A0909093C64706941776172653E547275653C2F64706941776172653E0D0A09093C2F77696E646F777353657474696E67733E0D0A093C2F6170706C69636174696F6E3E0D0A3C2F617373656D626C793E5050414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E47585850414444494E4750414444494E475858504144"
	HexEdit(objFile, sNewHex, 569398, 1)	; 0x0008B036 - CFFF
	sNewHex := ""							; 1 = Don't log
	FileAppend, Manifest appended to Setup.exe`n`n, %A_ScriptDir%\Modify Setup hex values.log,
	

	; Change style from WS_POPUP to WS_CAPTION + WS_MINIMIZEBOX 
	; 0x80000000h -> 0x00C20000h  -  https://docs.microsoft.com/en-us/windows/desktop/winmsg/window-styles
	HexEditThenAddToLog(objFile, "00", "ca", 398156)	; 0x0006134C
	HexEditThenAddToLog(objFile, "80", "00", 398157)	; 0x0006134D
	HexEditThenAddToLog(objFile, "00", "ca", 398296)	; 0x000613D8
	HexEditThenAddToLog(objFile, "80", "00", 398297)	; 0x000613D9

	objFile.Close()
	Return, True
}


HexEditThenAddToLog(objPassedFile, sOldHexValues, sNewHexValues, iPosition)
{
	HexEdit(objPassedFile, sNewHexValues, iPosition)
	FileAppend, %A_Tab%-  Above should say %iPosition%: 0x%sOldHexValues% replaced with 0x%sNewHexValues%`n`n, %A_ScriptDir%\Modify Setup hex values.log,
	Return
}


;	Many thanks to Wolf_II of the AutoHotkey forums for the HexEdit function below:
;	https://autohotkey.com/boards/viewtopic.php?t=20524
;-------------------------------------------------------------------------------
HexEdit(objSetupExe, Nibbles := "", Pos := 1, bDontLog := 0) { ; write Nibbles at pos
;-------------------------------------------------------------------------------
    ; If Filename does not exist, it will be created.
    ; Unacceptable Nibbles will be rejected.
    ; If Pos is larger than file length
    ;   Filename's length will be adjusted accordingly.
    ;   all undefined bytes in the file will be set to zero.
    ;---------------------------------------------------------------------------
    ; returns 1 if successful, 0 otherwise.
    ;---------------------------------------------------------------------------
	objSetupExe.Seek(Pos)
	sOldCharacters := SubStr("00" . DecToBase(objSetupExe.ReadChar(2), 16),-1)
	objSetupExe.Seek(Pos)
	
	sCurNibblesVal := Nibbles
    While Nibbles != ""
        objSetupExe.WriteChar("0x" SubStr(Nibbles, 1, 2))
        , Nibbles := SubStr(Nibbles, 3)
	If bDontLog = 0
		FileAppend, Data written to address %Pos%: 0x%sOldCharacters% replaced with 0x%sCurNibblesVal%`n, %A_ScriptDir%\Modify Setup hex values.log,

    Return, True
}

DecToBase(n, Base)
{
	Static U := A_IsUnicode ? "w" : "a"
	VarSetCapacity(S,65,0)
	DllCall("msvcrt\_i64to" U, "Int64",n, "Str",S, "Int",Base)
	Return, S
}